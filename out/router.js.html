<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>JSDoc: Source: router.js</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link
      type="text/css"
      rel="stylesheet"
      href="styles/prettify-tomorrow.css"
    />
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css" />
  </head>

  <body>
    <div id="main">
      <h1 class="page-title">Source: router.js</h1>

      <section>
        <article>
          <pre
            class="prettyprint source linenums"
          ><code>const { Router } = require("express");
const UserModel = require("../../database/models/user-model");
const routerController = require("./controller/common-controller");
const authMiddleWare = require("../my-middleware/authenticate_middleware.js");

const multer = require("multer");

const multerStorage = multer.diskStorage({
  destination:function(req , file, cb) {
    cb(null , 'uploads');
  } , 
  filename:function(req, file ,cb) {
    cb(null , Date.now().toString() + '---' + file.originalname);
  }
});

const upload_middleware = multer({
  storage:multerStorage
}) ;


const api_router = new Router();

api_router.post("/registration", routerController.user.registration);
api_router.post("/login", routerController.user.login);
api_router.post("/auth", (req, res) =>
  res.status(200).json({ status: true, message: "auth" }),
);

api_router.get("/account", authMiddleWare , routerController.user.account);
api_router.post("/logout", routerController.user.logout);

api_router.get("/news" , routerController.news.get_all) ;
api_router.post("/news" , (req, res , next) => {

  // console.log({request:req});
  next()

}, authMiddleWare , upload_middleware.single('my--file') , routerController.news.post_one);



/**
 * 
 * @param {*} request 
 * @param {*} response 
 */




api_router.get("/user/posts" , authMiddleWare , getUserPosts);



api_router.post('/testtest' , (req, res , next) => {

  console.log({req});
  next()

} , upload_middleware.single('my--file') , (req , res) => {

  console.log('hello');
  return res.status(200).json({hello:'world'});
})                      

module.exports = {api_router};


async function getUserPosts (request , response) {
  const {body , headers} = request ;

  if(!headers.authorization) return response.status(200).json(new MyResponse());

  

  return response.status(200).json({status , message , payload});
}

class MyResponse {

  /**
   * 
   * @param {*} payload 
   */

  addPayload (payload) {
    this.payloads.push(payload);
  }

  /**
   * 
   * @param {boolean} status 
   * @param {string} message 
   * @param {MyPayload[]} payloads 
   */

  constructor (status , message , payloads) {

    this.status = status ;
    this.message = message ;
    this.payloads = [...payloads] ;
  }
}


class MyPayload {

  /**
   * @description this is description
   * 
   * @param {string} descriptor 
   * @param {any} body 
   */

  constructor (descriptor ,body) {
    this.descriptor = descriptor ;
    this.body = body ;
  }
}</code></pre>
        </article>
      </section>
    </div>

    <nav>
      <h2><a href="index.html">Home</a></h2>
      <h3>Classes</h3>
      <ul>
        <li><a href="MyPayload.html">MyPayload</a></li>
        <li><a href="MyResponse.html">MyResponse</a></li>
      </ul>
    </nav>

    <br class="clear" />

    <footer>
      Documentation generated by
      <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Sat Apr 20
      2024 14:11:22 GMT+0300 (Moscow Standard Time)
    </footer>

    <script>
      prettyPrint();
    </script>
    <script src="scripts/linenumber.js"></script>
  </body>
</html>
